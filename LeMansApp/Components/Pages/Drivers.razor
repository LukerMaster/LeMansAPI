@page "/Drivers"
@using LeMansAPI.Models
@using Newtonsoft.Json
@using System.Net.Http.Headers
@inject IConfiguration config;


<h3>Drivers</h3>

@if (DriverList == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Last Name</th>
        </tr>
        </thead>
        <tbody>
            @foreach (var driver in DriverList)
        {
            <tr>
                <td>@driver.Id</td>
                <td>@driver.FirstName</td>
                <td>@driver.LastName</td>
                
            </tr>
        }
        </tbody>
    </table>
}


@code {
    Driver[] DriverList;

    protected async override Task OnInitializedAsync()
    {
        string url = config["ApiConfig:Url"];

        var httpClientHandler = new HttpClientHandler();
#if DEBUG
        httpClientHandler.ServerCertificateCustomValidationCallback = HttpClientHandler.DangerousAcceptAnyServerCertificateValidator;
#endif
        HttpClient client = new HttpClient(httpClientHandler);
        Uri uri = new Uri(url);
        client.BaseAddress = uri;

        // Add an Accept header for JSON format.
        client.DefaultRequestHeaders.Accept.Add(
            new MediaTypeWithQualityHeaderValue("application/json"));

        
        HttpResponseMessage response = await client.GetAsync(new Uri(uri, "api/Drivers"));

        // Check if the request was successful
        if (response.IsSuccessStatusCode)
        {
        // Deserialize the JSON response into a list of driver objects
            string jsonResponse = await response.Content.ReadAsStringAsync();
            List<Driver> drivers = JsonConvert.DeserializeObject<List<Driver>>(jsonResponse);
        }
    }
}
